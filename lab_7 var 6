#include <iostream>
#include <stdexcept>
#include <string>
#include <cmath>

using namespace std;

class GeoExV1 {}; 

class GeoExV2 {
public:
    string message;
    
    GeoExV2(double a0, double r, double an, const string& msg)
        : a0(a0), r(r), an(an), message(msg) {}
    
private:
    double a0, r, an;
};

class GeoExV3 : public invalid_argument {
public:
    GeoExV3(double a0, double r, double an, const string& msg)
        : invalid_argument(msg), a0(a0), r(r), an(an) {}
    
private:
    double a0, r, an;
};

double geom_sum_no_spec(double a0, double r, double an) {
    const double EPS = 1e-10;
    
    if (fabs(1 - r) < EPS) {
        throw runtime_error("Деление на ноль: знаменатель (1-r) равен нулю");
    }
    
    if (isnan(a0) || isnan(r) || isnan(an)) {
        throw invalid_argument("Один или несколько параметров NaN");
    }
    
    if (isinf(a0) || isinf(r) || isinf(an)) {
        throw overflow_error("Один или несколько параметров бесконечны");
    }
    
    double num = a0 - an * r;
    double den = 1 - r;
    
    if (isinf(num) || isinf(den)) {
        throw overflow_error("Переполнение при вычислениях");
    }
    
    return num / den;
}

double geom_sum_throw_empty(double a0, double r, double an) throw() {
    const double EPS = 1e-10;
    
    if (fabs(1 - r) < EPS) {
        throw runtime_error("Деление на ноль: знаменатель (1-r) равен нулю");
    }
    
    if (isnan(a0) || isnan(r) || isnan(an)) {
        throw invalid_argument("Один или несколько параметров NaN");
    }
    
    return (a0 - an * r) / (1 - r);
}

double geom_sum_standard_spec(double a0, double r, double an) 
    throw(invalid_argument, runtime_error, overflow_error) {
    
    const double EPS = 1e-10;
    
    if (fabs(1 - r) < EPS) {
        throw runtime_error("Деление на ноль: знаменатель (1-r) равен нулю");
    }
    
    if (isnan(a0) || isnan(r) || isnan(an)) {
        throw invalid_argument("Один или несколько параметров NaN");
    }
    
    if (isinf(a0) || isinf(r) || isinf(an)) {
        throw overflow_error("Один или несколько параметров бесконечны");
    }
    
    double num = a0 - an * r;
    double den = 1 - r;
    
    if (isinf(num) || isinf(den)) {
        throw overflow_error("Переполнение при вычислениях");
    }
    
    return num / den;
}

double geom_sum_custom_spec_v1(double a0, double r, double an) 
    throw(GeoExV1) {
    
    const double EPS = 1e-10;
    
    if (fabs(1 - r) < EPS) {
        throw GeoExV1();
    }
    
    if (isnan(a0) || isnan(r) || isnan(an)) {
        throw GeoExV1();
    }
    
    if (isinf(a0) || isinf(r) || isinf(an)) {
        throw GeoExV1();
    }
    
    double num = a0 - an * r;
    double den = 1 - r;
    
    if (isinf(num) || isinf(den)) {
        throw GeoExV1();
    }
    
    return num / den;
}

double geom_sum_custom_spec_v2(double a0, double r, double an) 
    throw(GeoExV2) {
    
    const double EPS = 1e-10;
    
    if (fabs(1 - r) < EPS) {
        throw GeoExV2(a0, r, an, "Деление на ноль: знаменатель (1-r) равен нулю");
    }
    
    if (isnan(a0) || isnan(r) || isnan(an)) {
        throw GeoExV2(a0, r, an, "Один или несколько параметров NaN");
    }
    
    if (isinf(a0) || isinf(r) || isinf(an)) {
        throw GeoExV2(a0, r, an, "Один или несколько параметров бесконечны");
    }
    
    double num = a0 - an * r;
    double den = 1 - r;
    
    if (isinf(num) || isinf(den)) {
        throw GeoExV2(a0, r, an, "Переполнение при вычислениях");
    }
    
    return num / den;
}

double geom_sum_custom_spec_v3(double a0, double r, double an) 
    throw(GeoExV3) {
    
    const double EPS = 1e-10;
    
    if (fabs(1 - r) < EPS) {
        throw GeoExV3(a0, r, an, "Деление на ноль: знаменатель (1-r) равен нулю");
    }
    
    if (isnan(a0) || isnan(r) || isnan(an)) {
        throw GeoExV3(a0, r, an, "Один или несколько параметров NaN");
    }
    
    if (isinf(a0) || isinf(r) || isinf(an)) {
        throw GeoExV3(a0, r, an, "Один или несколько параметров бесконечны");
    }
    
    double num = a0 - an * r;
    double den = 1 - r;
    
    if (isinf(num) || isinf(den)) {
        throw GeoExV3(a0, r, an, "Переполнение при вычислениях");
    }
    
    return num / den;
}

int main() {
    cout << "Тестирование функции суммы геометрической прогрессии\n" << endl;
    
    double a0_ok = 2.0, r_ok = 0.5, an_ok = 0.25;
    double a0_nan = NAN, r_nan = 0.5, an_nan = 0.25;
    double a0_inf = INFINITY, r_inf = 0.5, an_inf = 0.25;
    double a0_div0 = 2.0, r_div0 = 1.0, an_div0 = 1.0;
    
    double res;
    
    cout << "1. Вариант без спецификации исключений" << endl;
    
    try {
        res = geom_sum_no_spec(a0_ok, r_ok, an_ok);
        cout << "   Корректные данные Sn " << res << endl;
    }
    catch (const exception& e) {
        cout << "   Ошибка " << e.what() << endl;
    }
    
    try {
        res = geom_sum_no_spec(a0_div0, r_div0, an_div0);
        cout << "   Деление на ноль Sn " << res << endl;
    }
    catch (const exception& e) {
        cout << "   Перехвачено " << e.what() << endl;
    }
    
    cout << endl;
    
    cout << "2. Вариант со спецификацией throw()" << endl;
    
    try {
        res = geom_sum_throw_empty(a0_ok, r_ok, an_ok);
        cout << "   Корректные данные Sn " << res << endl;
    }
    catch (...) {
        cout << "   Исключение перехвачено" << endl;
    }
    
    cout << endl;
    
    cout << "3. Вариант с конкретной спецификацией" << endl;
    
    try {
        res = geom_sum_standard_spec(a0_ok, r_ok, an_ok);
        cout << "   Корректные данные Sn " << res << endl;
    }
    catch (const invalid_argument& e) {
        cout << "   invalid_argument " << e.what() << endl;
    }
    catch (const runtime_error& e) {
        cout << "   runtime_error " << e.what() << endl;
    }
    catch (const overflow_error& e) {
        cout << "   overflow_error " << e.what() << endl;
    }
    
    try {
        res = geom_sum_standard_spec(a0_div0, r_div0, an_div0);
        cout << "   Деление на ноль Sn " << res << endl;
    }
    catch (const runtime_error& e) {
        cout << "   runtime_error " << e.what() << endl;
    }
    
    cout << endl;
    
    cout << "4a. Собственное исключение пустой класс" << endl;
    
    try {
        res = geom_sum_custom_spec_v1(a0_ok, r_ok, an_ok);
        cout << "   Корректные данные Sn " << res << endl;
    }
    catch (const GeoExV1&) {
        cout << "   Перехвачено GeoExV1" << endl;
    }
    
    try {
        res = geom_sum_custom_spec_v1(a0_div0, r_div0, an_div0);
        cout << "   Деление на ноль Sn " << res << endl;
    }
    catch (const GeoExV1&) {
        cout << "   Перехвачено GeoExV1 при делении на ноль" << endl;
    }
    
    cout << endl;
    
    cout << "4b. Собственное исключение класс с полями" << endl;
    
    try {
        res = geom_sum_custom_spec_v2(a0_ok, r_ok, an_ok);
        cout << "   Корректные данные Sn " << res << endl;
    }
    catch (const GeoExV2& e) {
        cout << "   Ошибка " << e.message << endl;
    }
    
    try {
        res = geom_sum_custom_spec_v2(a0_div0, r_div0, an_div0);
        cout << "   Деление на ноль Sn " << res << endl;
    }
    catch (const GeoExV2& e) {
        cout << "   Ошибка деления на ноль " << e.message << endl;
    }
    
    cout << endl;
    
    cout << "4c. Собственное исключение наследник от std::exception" << endl;
    
    try {
        res = geom_sum_custom_spec_v3(a0_ok, r_ok, an_ok);
        cout << "   Корректные данные Sn " << res << endl;
    }
    catch (const GeoExV3& e) {
        cout << "   GeoExV3 " << e.what() << endl;
    }
    
    try {
        res = geom_sum_custom_spec_v3(a0_div0, r_div0, an_div0);
        cout << "   Деление на ноль Sn " << res << endl;
    }
    catch (const GeoExV3& e) {
        cout << "   GeoExV3 " << e.what() << endl;
    }
    
    try {
        res = geom_sum_custom_spec_v3(a0_nan, r_nan, an_nan);
        cout << "   NaN параметр Sn " << res << endl;
    }
    catch (const GeoExV3& e) {
        cout << "   GeoExV3 " << e.what() << endl;
    }
    
    cout << endl;
    
    return 0;
}
